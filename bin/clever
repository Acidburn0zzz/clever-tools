#! /usr/bin/env node

var _ = require("lodash");
var Logger = require("../src/logger.js");

function run(api) {
  var commands = {};

  var app = commands.app = require("../src/app.js");
  var login = commands.login = require("../src/login.js");
  var deploy = commands.deploy = require("../src/deploy.js");
  var log = commands.log = require("../src/log.js");
  var domain = commands.domain = require("../src/domain.js");
  var env = commands.env = require("../src/env.js");

  if(commands[process.argv[2]]) {
    commands[process.argv[2]](api);
  }
  else {
    Logger.error("Unknown command:", process.argv[2], "\n");
    _.each(commands, function(command, name) {
      if(command.usage) {
        Logger.error(command.usage);
      }
      _.each(command.subcommands, function(subcommand, name) {
        Logger.error(subcommand.usage);
      });
    });
  }
}

var s_api = require("../src/models/api.js")();
s_api.onValue(run);
s_api.onError(Logger.error.bind(console));
